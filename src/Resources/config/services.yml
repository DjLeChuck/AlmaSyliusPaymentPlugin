services:
  alma_sylius_payment_plugin.alma_payments:
    class: Payum\Core\Bridge\Symfony\Builder\GatewayFactoryBuilder
    arguments:
      - Alma\SyliusPaymentPlugin\Payum\Gateway\AlmaGatewayFactory

    tags:
      - name: payum.gateway_factory_builder
        factory: alma_payments


  Alma\SyliusPaymentPlugin\Form\Type\AlmaGatewayConfigurationType:
    arguments:
      $translator: '@translator'
      $almaBridge: '@alma_sylius_payment_plugin.bridge'
      $logger: '@logger'
    tags:
      - name: form.type
      - name: sylius.gateway_configuration_type
        type: alma_payments
        label: Alma Payments

  Alma\SyliusPaymentPlugin\Payum\Action\StatusAction:
    public: true
    tags:
      - name: payum.action
        factory: alma_payments
        alias: payum.action.status

  Alma\SyliusPaymentPlugin\Payum\Action\ConvertPaymentAction:
    public: true
    tags:
      - name: payum.action
        factory: alma_payments
        alias: payum.action.convert_payment

  Alma\SyliusPaymentPlugin\Payum\Action\CaptureAction:
    public: true
    tags:
      - name: payum.action
        factory: alma_payments
        alias: payum.action.capture

  Alma\SyliusPaymentPlugin\Payum\Action\ValidatePaymentAction:
    public: true
    tags:
      - name: payum.action
        factory: alma_payments

  Alma\SyliusPaymentPlugin\Payum\Action\NotifyAction:
    public: true
    tags:
      - name: payum.action
        factory: alma_payments
        alias: payum.action.notify

  Alma\SyliusPaymentPlugin\Payum\Extension\RefundFailedPaymentExtension:
    public: true
    arguments:
      $api: '@alma_sylius_payment_plugin.bridge'
      $logger: '@logger'
      $session: '@session'
    tags:
      - name: payum.extension
        factory: alma_payments

  alma_sylius_payment_plugin.bridge:
    public: true
    class: Alma\SyliusPaymentPlugin\Bridge\AlmaBridge
    arguments:
      $logger: '@logger'

  Alma\SyliusPaymentPlugin\Bridge\AlmaBridgeInterface: '@alma_sylius_payment_plugin.bridge'

  Alma\SyliusPaymentPlugin\Resolver\AlmaPaymentMethodsResolver:
    arguments:
      $paymentMethodRepository: '@sylius.repository.payment_method'
      $almaBridge: '@alma_sylius_payment_plugin.bridge'
    tags:
      - name: sylius.payment_method_resolver
        type: alma_payments
        label: sylius.payment_method_resolver.alma_payments
        priority: 10
